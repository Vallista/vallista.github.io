<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/gitment.css">
    
    

    <title>클로저 (Closure) - Today I Learned</title>

     
        <meta name="keywords" content="Tech,JavaScript">
    

    <meta name="description" content="클로저를 알기 위해, JavaScript는 Lexical Scope(유효 범위 지정)을 어떻게 하는지 알아야 한다. 참고:호이스팅, 실행 컨텍스트 유효 범위 지정 (Lexical Scope)function init() {   var name = &quot;Vallista&quot;   function displayName() {     alert(name)   }   dis">
<meta name="keywords" content="Tech,JavaScript">
<meta property="og:type" content="article">
<meta property="og:title" content="클로저 (Closure)">
<meta property="og:url" content="https://vallista.kr/2019/05/11/클로저-Closure/index.html">
<meta property="og:site_name" content="Today I Learned">
<meta property="og:description" content="클로저를 알기 위해, JavaScript는 Lexical Scope(유효 범위 지정)을 어떻게 하는지 알아야 한다. 참고:호이스팅, 실행 컨텍스트 유효 범위 지정 (Lexical Scope)function init() {   var name = &quot;Vallista&quot;   function displayName() {     alert(name)   }   dis">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2020-06-04T05:27:53.051Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="클로저 (Closure)">
<meta name="twitter:description" content="클로저를 알기 위해, JavaScript는 Lexical Scope(유효 범위 지정)을 어떻게 하는지 알아야 한다. 참고:호이스팅, 실행 컨텍스트 유효 범위 지정 (Lexical Scope)function init() {   var name = &quot;Vallista&quot;   function displayName() {     alert(name)   }   dis">
    
    <link rel="canonical" href="https://vallista.kr/2019/05/11/클로저-closure/">
    
    <meta name="naver-site-verification" content="981dd449900e4abd0f5aa265ce6849776b41a9c2">
    <meta name="google-site-verification" content="wPI09aIL9InuxJwKlMkLE-4mzzfbNhQqRCJ760C-8nQ">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="apple-touch-icon" sizes="57x57" href="/css/images/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/css/images/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/css/images/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/css/images/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/css/images/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/css/images/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/css/images/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/css/images/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/css/images/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/css/images/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/css/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/css/images/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/css/images/favicon-16x16.png">
    <link rel="manifest" href="/css/images/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/css/images/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-143764638-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', "UA-143764638-1");
    </script>


    <link href="//spoqa.github.io/spoqa-han-sans/css/SpoqaHanSans-kr.css" rel="stylesheet" type="text/css">
    <link href="//spoqa.github.io/spoqa-han-sans/css/SpoqaHanSans-jp.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="/css/prism-darcula.css" type="text/css"></head>
<body>
<header class="header">
    <div class="header-inner">
        <div class="header-title">

        </div>
        <nav class="header-nav">
            
            <a href="/" class="header-nav-link" >
                홈
            </a>
            

            
            <a href="/archives" class="header-nav-link">
                포스트
            </a>
            

            <a href="/resume" class="header-nav-link">
                이력서
            </a>
        </nav>
    </div>
</header>
<header class="mobile-header">
    <div class="mobile-nav">
        <div class="mobile-nav-icon">
            <span></span>
            <span></span>
            <span></span>
        </div>

    </div>
    <nav class="mobile-menu">
        <ul class="mobile-menu-list">
            <li class="mobile-menu-item">
                <i class="iconfont icon-home"></i>
                <a href="/" class="mobile-nav-link">홈</a>
            </li>
            <li class="mobile-menu-item">
                <i class="iconfont icon-archive"></i>
                <a href="/archives" class="mobile-nav-link">포스트</a>
            </li>
            <li class="mobile-menu-item">
                <i class="iconfont icon-archive"></i>
                <a href="/resume" class="mobile-nav-link">이력서</a>
            </li>
        </ul>
    </nav>
</header>
<div class="main">
    <div class="content-inner">
        <div class="post">
    <article class="post-whole">
        <div class="post-title">
            <h2 class="title">클로저 (Closure)</h2>
            <div class="post-meta">
                <span class="post-time">2019-05-11</span>
                
                <span class="post-visit"> 방문：<span id="busuanzi_value_page_pv"></span></span>
            </div>
        </div>
        <div class="post-toc" id="post-toc">
    <strong class="post-toc-title">목차</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#유효-범위-지정-Lexical-Scope"><span class="toc-text">유효 범위 지정 (Lexical Scope)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#클로저-Closure"><span class="toc-text">클로저 (Closure)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#조금-더-활용"><span class="toc-text">조금 더 활용</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ES6-es2015"><span class="toc-text">ES6 (es2015)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#잘못된-이해"><span class="toc-text">잘못된 이해</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#문제"><span class="toc-text">문제</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#왜-이럴까"><span class="toc-text">왜 이럴까?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#해결하기"><span class="toc-text">해결하기</span></a></li></ol>
    <div class="back-to-top" id="back-to-top">
        <a href="javascript:void(0);">처음으로</a>
    </div>
</div>
        <div class="post-content">
            <p>클로저를 알기 위해, JavaScript는 Lexical Scope(유효 범위 지정)을 어떻게 하는지 알아야 한다.</p>
<p>참고:<a href="https://www.notion.so/312260b5-c1b9-4a66-8807-29f87da4c242" target="_blank" rel="noopener">호이스팅, 실행 컨텍스트</a></p>
<h2 id="유효-범위-지정-Lexical-Scope"><a href="#유효-범위-지정-Lexical-Scope" class="headerlink" title="유효 범위 지정 (Lexical Scope)"></a>유효 범위 지정 (Lexical Scope)</h2><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">"Vallista"</span>
  <span class="token keyword">function</span> <span class="token function">displayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">displayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>init()은 지역 변수 name과 함수 displayName을 갖고있다. displayName은 init안에 있기 때문에 init 안에서만 사용할 수 있다. displayName는 변수가 없고, Parameter도 없다. 하지만 내부에서 alert (alert은 Global Object, Window에 정의되어 있다.)을 호출 할 때 상위 함수의 name을 가져와서 출력한다. </p>
<p>함수가 중첩 됐을 때 아래의 가이드 라인을 따른다.</p>
<ul>
<li>동일한 변수 명이 내부 함수와 외부 함수에 있다면 내부 함수에 있는 변수가 사용된다.</li>
<li>변수 명이 내부 함수에 없다면 실행 컨텍스트로 생성된 scope chain을 거슬러 올라가 부모 함수에서 가지고 있는 변수를 찾아, 호출한다.</li>
</ul>
<p>단어 <strong>Lexical은 유효 범위를 지정할 때 변수가 사용가능한 범위를 결정하기 위해 소스 코드 내에서 변수가 선언된 위치를 사용한다는 뜻</strong>이다.</p>
<p>즉 위 가이드 라인의 두 번째 이야기와 일맥상통 하는데, 변수가 현재 함수에 정의가 안되어 있으면, 소스코드에서 찾아서 (scope chain을 통해 거슬러 올라가) 찾는다는 이야기다.</p>
<h2 id="클로저-Closure"><a href="#클로저-Closure" class="headerlink" title="클로저 (Closure)"></a>클로저 (Closure)</h2><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">A</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">B</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    y <span class="token operator">=</span> <span class="token number">100</span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> y <span class="token operator">+</span> z
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 117</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">b</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 203</span></code></pre>
<p>클로저는 환경을 저장한다. 즉 환경을 만든 함수를 만들어낸다. 위의 예제를 보면 쉽게 이해할 수 있다.</p>
<p>a 는 A(10)을 실행한다. 실행해서 받는 결과값은 function B인데, 이 function B는 함수이므로 실행이 안되어 있는 상태이다. 즉, 함수로 함수를 반환 받는 <strong>고차함수</strong>이다.</p>
<p>b도 a가 받은 형태와 비슷하다. 이때 a, b가 받는 결과값은 다음과 같다.</p>
<pre class=" language-javascript"><code class="language-javascript">a <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">A</span><span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> B <span class="token punctuation">(</span>z<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    y <span class="token operator">=</span> <span class="token number">100</span>
    <span class="token keyword">return</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">y</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">+</span> z
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

b <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">A</span><span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> B <span class="token punctuation">(</span>z<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    y <span class="token operator">=</span> <span class="token number">100</span>
    <span class="token keyword">return</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">y</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">+</span> z
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>a, b 에는 각각 x자리에 10, 100이 들어간 상황에 대해서 저장한다.<br>그래서 a, b를 함수로 호출하면,</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token function">a</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">A</span><span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> B <span class="token punctuation">(</span>z <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    y <span class="token operator">=</span> <span class="token number">100</span>
    <span class="token keyword">return</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">y</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">z</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// 117</span>

<span class="token function">b</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">A</span><span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> B <span class="token punctuation">(</span>z <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    y <span class="token operator">=</span> <span class="token number">100</span>
    <span class="token keyword">return</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">y</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">z</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// 203</span></code></pre>
<p>이라는 결과가 나오게 된다.</p>
<h2 id="조금-더-활용"><a href="#조금-더-활용" class="headerlink" title="조금 더 활용"></a>조금 더 활용</h2><p>배열을 10번 돌려, 1초 후에 1,2,3,4,5,6,7,8,9,10 이 나오는 코드를 작성해보자.</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">printAfter1Sec</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">printAfter1sec</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p><code>printAfter1Sec</code>을 실행시키면 정상적인 결과가 나오지 않는다. 10번 모두 숫자 10이 출력된다.</p>
<p>그렇다면 여기서 클로저를 활용하여 함수가 실행되는 환경을 저장시켜 실행 해보자.</p>
<blockquote>
<p>setTimeout 함수의 첫번째 인자에 함수명을 작성하지 않고 정의했다. 이런 함수를 익명함수(Anonymous Function)라고 한다.</p>
</blockquote>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">printAfter1Sec</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> closure <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> temp <span class="token operator">=</span> i
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>temp <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">closure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">printAfter1Sec</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>내부 함수 closure를 호출할 때마다 i의 환경을 기억하도록 작성했다. 이는 다음과 같이 표현할 수 있다.</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">printAfter1Sec</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> temp <span class="token operator">=</span> i
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>temp <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">printAfter1Sec</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">printAfter1Sec</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">printAfter1Sec</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>익명함수를 불러서 바로 호출하는 (IIFE) 즉시호출 함수로 만들어서 부를 수 있다.</p>
<h2 id="ES6-es2015"><a href="#ES6-es2015" class="headerlink" title="ES6 (es2015)"></a>ES6 (es2015)</h2><p>ES6에서는 블록 스코프를 사용하여 해결할 수 있다.</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">printAfter1Sec</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">printAfter1Sec</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>ES6에서 새로 추가된 const, let은 기존의 Lexical Scope이 아닌, Block Scope 단위로 동작한다.</p>
<p>그러므로, i는 블록 단위로 변수가 만들어지기 때문에 값이 남지 않고 블록 단위로 값이 다르게 출력될 수 있다.</p>
<p><a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Guide/Closures" target="_blank" rel="noopener">클로저</a></p>
<h2 id="잘못된-이해"><a href="#잘못된-이해" class="headerlink" title="잘못된 이해"></a>잘못된 이해</h2><p>Closure를 사용하는 이유는 es6 이전 block scope가 아닌, function scope로 JavaScript가 Scope을 잡으면서 생기는 문제를 해결하기 위해서 사용한다.</p>
<p>흔히 Closure를 이야기할 때 예시로 드는 setTimeOut으로 이야기를 들어보자. 간단하게 1초 후 로그를 찍는 함수를 만들어보자.</p>
<h2 id="문제"><a href="#문제" class="headerlink" title="문제"></a>문제</h2><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">printAfter1Sec</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hi'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<p>이 함수를 실행하면 1초 후에 hi가 출력되는 걸 볼 수 있다.</p>
<p>그렇다면 이 함수를 변형해서 1초 후 1부터 10까지 출력하는 함수를 만들어보자.</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">printAfter1Sec</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>실행해보면 잘 나오는가? 아니, 10만 10번 출력된다.</p>
<h2 id="왜-이럴까"><a href="#왜-이럴까" class="headerlink" title="왜 이럴까?"></a>왜 이럴까?</h2><p>JavaScript는 C,C++등의 언어와 달리, Block Scope이 아니라 Function Scope인데, 이 Function Scope은 <strong>Execute Context(실행 컨텍스트)</strong>를 알면 쉽게 이해할 수 있다.</p>
<p>Function Scope를 지니므로, for loop에서 도는 i는 printAfter1Sec 내부의 실행컨텍스트에 등록되어, i++ 될 때마다 상태가 변경되고 setTimeout에서는 printAfter1Sec의 실행 컨텍스트에서 i를 불러와 1초후에 i의 값을 출력하므로 이미 i가 10일때를 기준으로 출력하게 된다.</p>
<h2 id="해결하기"><a href="#해결하기" class="headerlink" title="해결하기"></a>해결하기</h2><p>쉽게 생각하자. function 단위로 실행 컨텍스트가 만들어지므로, setTimeout을 실행하는 함수를 만들면 된다.</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">printAfter1Sec</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> keep <span class="token operator">=</span> i
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>keep <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>for 내부에 익명 함수를 만들어 즉시 실행 함수 표현(Immediately invoked Function expression)을 만들었다. 이렇게 되면 for루프를 돌음과 동시에 익명함수를 만들어, 익명함수의 실행 컨텍스트에 keep을 등록하고 keep의 값에는 i를 대입하게 된다. 그 후, setTimeout에서 가져오는 keep값은 익명함수의 실행 컨텍스트의 keep을 가져와서 출력하므로 1부터 10까지 숫자가 나오게 된다.</p>
<p>여기서 익명 함수가 바로 클로저 (Closure) 이다.</p>

        </div>
        
        <div class="post-tag">
            
            <a class="tag" href="/tags/Tech/" title="Tech">Tech</a>
            
            <a class="tag" href="/tags/JavaScript/" title="JavaScript">JavaScript</a>
            
        </div>
        
    </article>
    <div id="disqus_thread"></div>
    <script>

    /**
    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://vallista-1.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
<div class="paginator">
    
        
            <a class="prev" href="/2019/05/11/이벤트-버블링-캡쳐링-위임/">
                <div class="wrapper">
                    <i class="iconfont icon-prev"></i>
                    <
                    <span class="nav-default">이벤트 버블링, 캡쳐링, 위임</span>
                    <span class="nav-mobile">이전글</span>
                </div>
            </a>
        
        
            <a class="next" href="/2019/05/10/Call-By-Value-Call-By-Reference/">
                <div class="wrapper">
                    <span class="nav-default">Call By Value, Call By Reference</span>
                    <span class="nav-mobile">다음글</span>
                    >
                    <i class="iconfont icon-next"></i>
                </div>
            </a>
        
    
</div>
<div id="comment-container"></div>
    </div>
</div>
<footer class="footer-social">
    

    

    

    <div class="footer-copyright">
        <p class="time-line">
            &copy;
            
            
            2020
            &nbsp;<i class="iconfont icon-heart"></i>&nbsp;
            <a target="_blank" href="https://github.com/vallista">Vallista</a>
        </p>
        <p class="theme-info">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Theme -
            <a target="_blank" href="https://github.com/">Vallista</a>
        </p>
    </div>
</footer>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
    

</script>
</html>
