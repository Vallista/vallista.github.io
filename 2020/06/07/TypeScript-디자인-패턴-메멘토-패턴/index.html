<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/gitment.css">
    
    

    <title>TypeScript 디자인 패턴 - 메멘토 패턴 - Today I Learned</title>

     
        <meta name="keywords" content="Tech">
    

    <meta name="description" content="메멘토 패턴설계 문제에 대해서 해답을 문서화 해놓은 디자인 패턴에는 생성, 구조, 행동, 동시실행과 같은 분류가 있습니다. 그 중에서 메멘토 패턴은 동작에 대한 패턴입니다. 메멘토 패턴은 초기 HP 제품을 위해 Noah Thompson과 Dr.Drew Clinkenbeard에 의해 제작되었으며, 객체는 구현 변경 테스트 재사용이 쉬워야 한다 는 것을 기">
<meta name="keywords" content="Tech">
<meta property="og:type" content="article">
<meta property="og:title" content="TypeScript 디자인 패턴 - 메멘토 패턴">
<meta property="og:url" content="https://vallista.kr/2020/06/07/TypeScript-디자인-패턴-메멘토-패턴/index.html">
<meta property="og:site_name" content="Today I Learned">
<meta property="og:description" content="메멘토 패턴설계 문제에 대해서 해답을 문서화 해놓은 디자인 패턴에는 생성, 구조, 행동, 동시실행과 같은 분류가 있습니다. 그 중에서 메멘토 패턴은 동작에 대한 패턴입니다. 메멘토 패턴은 초기 HP 제품을 위해 Noah Thompson과 Dr.Drew Clinkenbeard에 의해 제작되었으며, 객체는 구현 변경 테스트 재사용이 쉬워야 한다 는 것을 기">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://vallista.kr/2020/06/07/TypeScript-디자인-패턴-메멘토-패턴/0.jpg">
<meta property="og:image" content="https://vallista.kr/2020/06/07/TypeScript-디자인-패턴-메멘토-패턴/1.jpg">
<meta property="og:image" content="https://vallista.kr/2020/06/07/TypeScript-디자인-패턴-메멘토-패턴/2.jpg">
<meta property="og:image" content="https://github.com/Vallista/React-Memento-Pattern-Use-TypeScript/blob/master/screenshots/1.gif?raw=true">
<meta property="og:image" content="https://github.com/Vallista/React-Memento-Pattern-Use-TypeScript/blob/master/screenshots/1.gif?raw=true">
<meta property="og:updated_time" content="2020-06-07T09:41:05.988Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="TypeScript 디자인 패턴 - 메멘토 패턴">
<meta name="twitter:description" content="메멘토 패턴설계 문제에 대해서 해답을 문서화 해놓은 디자인 패턴에는 생성, 구조, 행동, 동시실행과 같은 분류가 있습니다. 그 중에서 메멘토 패턴은 동작에 대한 패턴입니다. 메멘토 패턴은 초기 HP 제품을 위해 Noah Thompson과 Dr.Drew Clinkenbeard에 의해 제작되었으며, 객체는 구현 변경 테스트 재사용이 쉬워야 한다 는 것을 기">
<meta name="twitter:image" content="https://vallista.kr/2020/06/07/TypeScript-디자인-패턴-메멘토-패턴/0.jpg">
    
    <link rel="canonical" href="https://vallista.kr/2020/06/07/typescript-디자인-패턴-메멘토-패턴/">
    
    <meta name="naver-site-verification" content="981dd449900e4abd0f5aa265ce6849776b41a9c2">
    <meta name="google-site-verification" content="wPI09aIL9InuxJwKlMkLE-4mzzfbNhQqRCJ760C-8nQ">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="apple-touch-icon" sizes="57x57" href="/css/images/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/css/images/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/css/images/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/css/images/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/css/images/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/css/images/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/css/images/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/css/images/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/css/images/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/css/images/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/css/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/css/images/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/css/images/favicon-16x16.png">
    <link rel="manifest" href="/css/images/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/css/images/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-143764638-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', "UA-143764638-1");
    </script>


    <link href="//spoqa.github.io/spoqa-han-sans/css/SpoqaHanSans-kr.css" rel="stylesheet" type="text/css">
    <link href="//spoqa.github.io/spoqa-han-sans/css/SpoqaHanSans-jp.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="/css/prism-darcula.css" type="text/css"></head>
<body>
<header class="header">
    <div class="header-inner">
        <div class="header-title">

        </div>
        <nav class="header-nav">
            
            <a href="/" class="header-nav-link" >
                홈
            </a>
            

            
            <a href="/archives" class="header-nav-link">
                포스트
            </a>
            

            <a href="/resume" class="header-nav-link">
                이력서
            </a>
        </nav>
    </div>
</header>
<header class="mobile-header">
    <div class="mobile-nav">
        <div class="mobile-nav-icon">
            <span></span>
            <span></span>
            <span></span>
        </div>

    </div>
    <nav class="mobile-menu">
        <ul class="mobile-menu-list">
            <li class="mobile-menu-item">
                <i class="iconfont icon-home"></i>
                <a href="/" class="mobile-nav-link">홈</a>
            </li>
            <li class="mobile-menu-item">
                <i class="iconfont icon-archive"></i>
                <a href="/archives" class="mobile-nav-link">포스트</a>
            </li>
            <li class="mobile-menu-item">
                <i class="iconfont icon-archive"></i>
                <a href="/resume" class="mobile-nav-link">이력서</a>
            </li>
        </ul>
    </nav>
</header>
<div class="main">
    <div class="content-inner">
        <div class="post">
    <article class="post-whole">
        <div class="post-title">
            <h2 class="title">TypeScript 디자인 패턴 - 메멘토 패턴</h2>
            <div class="post-meta">
                <span class="post-time">2020-06-07</span>
                
                <span class="post-visit"> 방문：<span id="busuanzi_value_page_pv"></span></span>
            </div>
        </div>
        <div class="post-toc" id="post-toc">
    <strong class="post-toc-title">목차</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#메멘토-패턴"><span class="toc-text">메멘토 패턴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#메멘토-패턴-1"><span class="toc-text">메멘토 패턴</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#오리지네이터-Originator"><span class="toc-text">오리지네이터 (Originator)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#케어테이커-Caretaker"><span class="toc-text">케어테이커 (Caretaker)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#메멘토-Memento"><span class="toc-text">메멘토 (Memento)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#구조"><span class="toc-text">구조</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#구현"><span class="toc-text">구현</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#모델"><span class="toc-text">모델</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#React-component-hooks-구현"><span class="toc-text">React component, hooks 구현</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#App-적용"><span class="toc-text">App 적용</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#실행"><span class="toc-text">실행</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#결론"><span class="toc-text">결론</span></a></li></ol>
    <div class="back-to-top" id="back-to-top">
        <a href="javascript:void(0);">처음으로</a>
    </div>
</div>
        <div class="post-content">
            <p><img src="0.jpg" alt="이미지0"></p>
<h2 id="메멘토-패턴"><a href="#메멘토-패턴" class="headerlink" title="메멘토 패턴"></a>메멘토 패턴</h2><p>설계 문제에 대해서 해답을 문서화 해놓은 디자인 패턴에는 생성, 구조, 행동, 동시실행과 같은 분류가 있습니다. 그 중에서 메멘토 패턴은 동작에 대한 패턴입니다.</p>
<p>메멘토 패턴은 초기 HP 제품을 위해 <code>Noah Thompson</code>과 <code>Dr.Drew Clinkenbeard</code>에 의해 제작되었으며, 객체는 <code>구현 변경 테스트 재사용이 쉬워야 한다</code> 는 것을 기술한 <code>23가지 GOF의 디자인패턴</code> 중 하나입니다.</p>
<p>이 패턴이 해결할 수 있는 문제는 <code>객체 내부 상태를 저장하므로써 객체 상태가 변경되었을 때 이전 상태로의 복구</code> 입니다. 즉, 쉽게 이야기 하면 이전 상태(원상태)로 되돌리는 역할을 합니다. 이 패턴이 주요로 사용되는 곳은 에러 콜백, 삭제에 대한 되돌림와 같은 유저 액션에 대해서도 충분히 대응이 가능합니다.</p>
<p>특히나 메멘토 패턴은 <code>캡슐화를 해치지 않는 선에서 내부 상태에 대한 원복</code>을 목표로 하기 때문에, 객체지향 관점에서 효과적이라 볼 수 있습니다. 하지만 캡슐화가 잘 된 객체는 데이터 구조가 잘 숨겨져 있기 때문에 객체의 외부에서 접근이 쉽지 않습니다. 어떻게 접근할 수 있을까요?</p>
<h2 id="메멘토-패턴-1"><a href="#메멘토-패턴-1" class="headerlink" title="메멘토 패턴"></a>메멘토 패턴</h2><p>메멘토 패턴은 캡슐화가 잘 된 객체에 접근할 수 있도록 3가지 객체로 이루어집니다.</p>
<h3 id="오리지네이터-Originator"><a href="#오리지네이터-Originator" class="headerlink" title="오리지네이터 (Originator)"></a>오리지네이터 (Originator)</h3><p>오리지네이터는 내부의 상태를 가지고 있는 객체입니다.</p>
<ul>
<li>객체에 내부 상태를 저장</li>
<li>객체로부터 이전 상태를 복구</li>
</ul>
<p>오리지네이터는 단독으로 객체에 접근할 수 있습니다.</p>
<h3 id="케어테이커-Caretaker"><a href="#케어테이커-Caretaker" class="headerlink" title="케어테이커 (Caretaker)"></a>케어테이커 (Caretaker)</h3><p>케어테이커는 오리지네이터에 대해서 액션을 제공하지만, 변경에 대한 취소 및 저장에 대해서만 제공합니다. 다른 기능도 제공하게 되면 단일-책임원칙에 위배되기 때문입니다.</p>
<h3 id="메멘토-Memento"><a href="#메멘토-Memento" class="headerlink" title="메멘토 (Memento)"></a>메멘토 (Memento)</h3><p>메멘토 객체는 Originator와 반대로, 변경되기 이 전의 상태를 갖고있는 객체입니다.</p>
<br>

<p>위의 3가지 객체는 아래의 순서대로 작동합니다.</p>
<ol>
<li>케어테이커는 오리지네이터에 대해서 변경에 대한 실행 취소를 진행합니다.</li>
<li>그러기 위해 오리지네이터에게 메멘토 객체를 요청합니다.</li>
<li>오리지네이터는 내부 상태를 변경하기위해서 메멘토 객체를 반환하며 케어테이커는 반환된 메멘토 객체를 적용합니다.</li>
</ol>
<br>

<p>케어테이커(클라이언트)는 오리지네이터로 부터 메멘토를 요청합니다. 이는 오리지네이터의 내부 상태를 저장하기 위함이며, 오리지네이터에게 메멘토를 다시 돌려줄 수 있습니다.</p>
<h2 id="구조"><a href="#구조" class="headerlink" title="구조"></a>구조</h2><p><img src="1.jpg" alt="이미지1"><br>(사진 1. 메멘토의 구조)</p>
<br>

<p><img src="2.jpg" alt="이미지2"><br>(사진 2. Saving, Restoring 프로세스)</p>
<br>

<p>이 프로세스를 React 프로젝트를 적용하기 이전에 코드를 살펴봅시다.</p>
<br>

<pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Originator</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> state1<span class="token punctuation">:</span> string
  <span class="token keyword">public</span> state2<span class="token punctuation">:</span> string

  <span class="token function">constructor</span><span class="token punctuation">(</span>state1<span class="token punctuation">:</span> string<span class="token punctuation">,</span> state2<span class="token punctuation">:</span> string<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state1 <span class="token operator">=</span> state1
    <span class="token keyword">this</span><span class="token punctuation">.</span>state2 <span class="token operator">=</span> state2
  <span class="token punctuation">}</span>

  <span class="token function">createMemento</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Memento <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Memento</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state1<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state2<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">restoreMemento</span><span class="token punctuation">(</span>memento<span class="token punctuation">:</span> Memento<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state1 <span class="token operator">=</span> memento<span class="token punctuation">.</span>state1
    <span class="token keyword">this</span><span class="token punctuation">.</span>state2 <span class="token operator">=</span> memento<span class="token punctuation">.</span>state2
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Memento</span> <span class="token punctuation">{</span>
  readonly state1<span class="token punctuation">:</span> string
  readonly state2<span class="token punctuation">:</span> string

  <span class="token function">constructor</span><span class="token punctuation">(</span>state1<span class="token punctuation">:</span> string<span class="token punctuation">,</span> state2<span class="token punctuation">:</span> string<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state1 <span class="token operator">=</span> state1
    <span class="token keyword">this</span><span class="token punctuation">.</span>state2 <span class="token operator">=</span> state2
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">CareTaker</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> memento<span class="token punctuation">:</span> Memento<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

  <span class="token function">saving</span><span class="token punctuation">(</span>originator<span class="token punctuation">:</span> Originator<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>memento<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>originator<span class="token punctuation">.</span><span class="token function">createMemento</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">restoring</span><span class="token punctuation">(</span>originator<span class="token punctuation">:</span> Originator<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>memento<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span>

    originator<span class="token punctuation">.</span><span class="token function">restoreMemento</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>memento<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>memento<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">const</span> originator<span class="token punctuation">:</span> Originator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Originator</span><span class="token punctuation">(</span><span class="token string">'first'</span><span class="token punctuation">,</span> <span class="token string">'one'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> careTaker<span class="token punctuation">:</span> CareTaker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CareTaker</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

careTaker<span class="token punctuation">.</span><span class="token function">saving</span><span class="token punctuation">(</span>originator<span class="token punctuation">)</span>

originator<span class="token punctuation">.</span>state1 <span class="token operator">=</span> <span class="token string">'second'</span>
originator<span class="token punctuation">.</span>state2 <span class="token operator">=</span> <span class="token string">'two'</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>originator<span class="token punctuation">)</span>

careTaker<span class="token punctuation">.</span><span class="token function">restoring</span><span class="token punctuation">(</span>originator<span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>originator<span class="token punctuation">)</span></code></pre>
<p><code>careTaker</code> 객체는 originator 객체를 받아 저장 및 복원을 진행합니다. Originator는 Memento를 만들어낼 뿐이지, 자신의 상태에 대해서만 가지고 있습니다. 실제로 일을 하는 곳은 <code>CareTaker</code>라 보시면되고, 스냅샷을 <code>Memento</code>라고 이해하시면 되겠습니다.</p>
<p>그렇다면 이렇게 이해한 코드를 바탕으로 구현을 해보도록 합시다.</p>
<h2 id="구현"><a href="#구현" class="headerlink" title="구현"></a>구현</h2><p>해당 코드는 <a href="https://github.com/Vallista/React-Memento-Pattern-Use-TypeScript" target="_blank" rel="noopener">React-Memento-Pattern-Use-TypeScript</a>에서 확인할 수 있습니다.</p>
<p><img src="https://github.com/Vallista/React-Memento-Pattern-Use-TypeScript/blob/master/screenshots/1.gif?raw=true" alt="1"><br>(사진 3. 실행 결과)</p>
<p>Todo List 예시를 사용하여 변화에 대해서 롤백할 수 있는 기능을 메멘토 패턴으로 추가를 해보겠습니다.</p>
<h3 id="모델"><a href="#모델" class="headerlink" title="모델"></a>모델</h3><p><strong>src/models/memento.ts</strong></p>
<pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">IOriginator</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">></span></span> <span class="token punctuation">{</span>
  <span class="token function">createMemento</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> T
  <span class="token function">restoreMemento</span><span class="token punctuation">(</span>memento<span class="token punctuation">:</span> T<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CareTaker</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">></span></span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> mementoList<span class="token punctuation">:</span> T<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

  <span class="token function">saving</span><span class="token punctuation">(</span>originator<span class="token punctuation">:</span> IOriginator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">></span></span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mementoList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>originator<span class="token punctuation">.</span><span class="token function">createMemento</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">restoring</span><span class="token punctuation">(</span>originator<span class="token punctuation">:</span> IOriginator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">></span></span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mementoList<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span>

    originator<span class="token punctuation">.</span><span class="token function">restoreMemento</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mementoList<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>mementoList<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mementoList<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mementoList<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>메멘토 패턴에 들어가는 기본적인 인터페이스와 클래스입니다.</p>
<p>IOriginator는 Original 객체에 대해서 느슨한 결합으로 추가할 수 있게 도와줍니다. 현재 객체의 상태에 대해서 저장하기 위해, Generic으로 T를 받아, 해당 타입을 반환하고 restore시 parameter로 받을 수 있도록 함수를 만듭니다.</p>
<p>CareTaker는 단독으로 사용될 수 있어야 합니다. 그렇기 때문에 느슨한 연결보다, 클래스로 기능을 명시합니다. CareTaker에서 진행할 내용은 저장과 롤백 두 가지 기능을 진행할 것 입니다. 해당 객체에 대해서 상태를 저장할 수 있도록 generic으로 T를 받고, T 타입에 대해서 상태를 여러개 물 수 있도록 T[] 와같은 배열 형태로 구현합니다. 이 배열은 힙으로 사용할 예정입니다. 저장할 때에는 T를 받아 push를 진행해주고, 롤백시에는 힙으로 사용하므로 가장 뒤에 있는 T를 가져와 적용하고, replacement 하도록 설계합니다.</p>
<br>

<p><strong>src/models/Removable</strong></p>
<pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">export</span> <span class="token keyword">enum</span> RemoveState <span class="token punctuation">{</span>
  IDLE <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
  REMOVE
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">IRemovable</span> <span class="token punctuation">{</span>
  <span class="token function">getRemoveState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> RemoveState
  <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span></code></pre>
<p>Removable은 상태에 대한 enum 값과, 삭제가능한 객체인지를 알려주는 Interface로 구성됩니다. Removable을 구현하는 클래스는 느슨한 결합으로 쉽게 추가하고 붙일 수 있습니다.</p>
<br>

<p><strong>Todo.ts</strong></p>
<pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> IRemovable<span class="token punctuation">,</span> RemoveState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./Removable"</span>

<span class="token keyword">class</span> <span class="token class-name">Todo</span> <span class="token keyword">implements</span> <span class="token class-name">IRemovable</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> removeState<span class="token punctuation">:</span> RemoveState
  <span class="token keyword">private</span> readonly message<span class="token punctuation">:</span> string

  <span class="token function">constructor</span><span class="token punctuation">(</span>message<span class="token punctuation">:</span> string<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>removeState <span class="token operator">=</span> RemoveState<span class="token punctuation">.</span>IDLE
    <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message

    <span class="token keyword">this</span><span class="token punctuation">.</span>remove <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>remove<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>message
  <span class="token punctuation">}</span>

  <span class="token function">getRemoveState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>removeState
  <span class="token punctuation">}</span>

  <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>removeState <span class="token operator">!==</span> RemoveState<span class="token punctuation">.</span>REMOVE<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>removeState <span class="token operator">=</span> RemoveState<span class="token punctuation">.</span>REMOVE
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Todo</code></pre>
<p>Todo 객체를 추상화한 Todo 클래스는 삭제상태와 메시지를 멤버 변수로 갖고 있습니다. 캡슐화를 완성하기 위해서 멤버변수는 은닉화를 해주었고, 외부 진입에 대해서 한정적이게 하도록 get 함수로 외부로의 연결통로를 두었습니다.</p>
<br>

<p><strong>TodoList.ts</strong></p>
<pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">import</span> Todo <span class="token keyword">from</span> <span class="token string">"./Todo"</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RemoveState<span class="token punctuation">,</span> IRemovable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./Removable'</span>

<span class="token keyword">class</span> <span class="token class-name">TodoList</span> <span class="token keyword">implements</span> <span class="token class-name">IRemovable</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> todos<span class="token punctuation">:</span> Todo<span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">private</span> removeState<span class="token punctuation">:</span> RemoveState <span class="token operator">=</span> RemoveState<span class="token punctuation">.</span>IDLE

  <span class="token function">constructor</span><span class="token punctuation">(</span>todos<span class="token punctuation">:</span> Todo<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>todos<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>todos <span class="token operator">=</span> todos

      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>todos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Todo</span><span class="token punctuation">(</span><span class="token string">'테스트'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>add <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>add<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>remove <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>remove<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">getTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> todo<span class="token punctuation">.</span><span class="token function">getRemoveState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> RemoveState<span class="token punctuation">.</span>REMOVE<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">add</span><span class="token punctuation">(</span>message<span class="token punctuation">:</span> string<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Todo</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>removeState <span class="token operator">!==</span> RemoveState<span class="token punctuation">.</span>REMOVE<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>removeState <span class="token operator">=</span> RemoveState<span class="token punctuation">.</span>REMOVE
  <span class="token punctuation">}</span>

  <span class="token function">getRemoveState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>removeState
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> TodoList</code></pre>
<p>TodoList는 생성 말고도 데이터를 덮어쓰기 가능하도록 constructor에 예외를 줍니다. 해당 부분은 뒤에서 설명이 좀 더 이루어 집니다.</p>
<br>

<p><strong>TodoListCollection.ts</strong></p>
<pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">import</span> TodoList <span class="token keyword">from</span> <span class="token string">"./TodoList"</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> IOriginator <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./Memento"</span>
<span class="token keyword">import</span> Todo <span class="token keyword">from</span> <span class="token string">"./Todo"</span>

<span class="token keyword">class</span> <span class="token class-name">TodoListCollection</span> <span class="token keyword">implements</span> <span class="token class-name">IOriginator</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TodoListCollection</span><span class="token punctuation">></span></span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> todoList<span class="token punctuation">:</span> TodoList<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span>list<span class="token punctuation">:</span> TodoList<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>list<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>todoList <span class="token operator">=</span> list
  <span class="token punctuation">}</span>

  <span class="token function">setTodoList</span><span class="token punctuation">(</span>list<span class="token punctuation">:</span> TodoList<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>todoList <span class="token operator">=</span> list
  <span class="token punctuation">}</span>

  <span class="token function">getTodoList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>todoList
  <span class="token punctuation">}</span>

  <span class="token function">createMemento</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> TodoListCollection <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TodoListCollection</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>todoList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>list <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> todoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TodoList</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">getTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>todo <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">new</span> <span class="token class-name">Todo</span><span class="token punctuation">(</span>todo<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> todoList
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">restoreMemento</span><span class="token punctuation">(</span>memento<span class="token punctuation">:</span> TodoListCollection<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>todoList <span class="token operator">=</span> memento<span class="token punctuation">.</span><span class="token function">getTodoList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> TodoListCollection</code></pre>
<p>TodoListCollection은 실제 렌더링은 되지 않지만 상태를 갖고있는 Originator 클래스 입니다.</p>
<p>해당 클래스에서 메멘토를 만들고, 상태에 대해서 적용하는 코드가 탄생합니다.</p>
<p>createMemento에서는 TodoListCollection단위로 객체를 재 생성합니다. 이렇게 재생성 하는 이유는 JavaScript의 Prototype의 한계가 있기 때문입니다. 그래서 DeepCopy를 통해 데이터를 재바인딩 합니다.</p>
<h2 id="React-component-hooks-구현"><a href="#React-component-hooks-구현" class="headerlink" title="React component, hooks 구현"></a>React component, hooks 구현</h2><p>이제 이 모델을 사용해야하는데 React와 객체지향 모델과의 결합을 하는 예제는 많지 않기 때문에 생소할 수 있습니다. 그래서, 최근 가장 많이 사용한다는 hooks와 functional component 형태로 제작해보겠습니다.</p>
<br>

<p><strong>src/hooks/useTodo.tsx</strong></p>
<pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> TodoList <span class="token keyword">from</span> <span class="token string">'../models/TodoList'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> CareTaker <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../models/Memento'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> TodoListCollection <span class="token keyword">from</span> <span class="token string">'../models/TodoListCollection'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> careTaker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CareTaker</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TodoListCollection</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> originator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TodoListCollection</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">useTodo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>todoListCollection<span class="token punctuation">,</span> setTodoListCollection<span class="token punctuation">]</span> <span class="token operator">=</span> useState<span class="token operator">&lt;</span>TodoList<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> reRender <span class="token operator">=</span> <span class="token punctuation">(</span>other<span class="token punctuation">:</span> TodoList<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token function">setTodoListCollection</span><span class="token punctuation">(</span>
      <span class="token punctuation">[</span><span class="token operator">...</span>todoListCollection<span class="token punctuation">,</span> <span class="token operator">...</span>other<span class="token punctuation">]</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> addTodoList <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    originator<span class="token punctuation">.</span><span class="token function">setTodoList</span><span class="token punctuation">(</span>todoListCollection<span class="token punctuation">)</span>
    careTaker<span class="token punctuation">.</span><span class="token function">saving</span><span class="token punctuation">(</span>originator<span class="token punctuation">)</span>

    <span class="token keyword">const</span> todoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TodoList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token function">reRender</span><span class="token punctuation">(</span><span class="token punctuation">[</span>todoList<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> addTodo <span class="token operator">=</span> <span class="token punctuation">(</span>TodoList<span class="token punctuation">:</span> TodoList<span class="token punctuation">,</span> message<span class="token punctuation">:</span> string<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    originator<span class="token punctuation">.</span><span class="token function">setTodoList</span><span class="token punctuation">(</span>todoListCollection<span class="token punctuation">)</span>
    careTaker<span class="token punctuation">.</span><span class="token function">saving</span><span class="token punctuation">(</span>originator<span class="token punctuation">)</span>

    TodoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
    <span class="token function">reRender</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> allAddTodo <span class="token operator">=</span> <span class="token punctuation">(</span>message<span class="token punctuation">:</span> string<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    originator<span class="token punctuation">.</span><span class="token function">setTodoList</span><span class="token punctuation">(</span>todoListCollection<span class="token punctuation">)</span>
    careTaker<span class="token punctuation">.</span><span class="token function">saving</span><span class="token punctuation">(</span>originator<span class="token punctuation">)</span>

    todoListCollection<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">reRender</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> allRemoveTodo <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">'정말 삭제하시겠습니까?'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      originator<span class="token punctuation">.</span><span class="token function">setTodoList</span><span class="token punctuation">(</span>todoListCollection<span class="token punctuation">)</span>
      careTaker<span class="token punctuation">.</span><span class="token function">saving</span><span class="token punctuation">(</span>originator<span class="token punctuation">)</span>

      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>originator<span class="token punctuation">)</span>

      todoListCollection<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        list<span class="token punctuation">.</span><span class="token function">getTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>todo <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
          todo<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token function">reRender</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> rollback <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    careTaker<span class="token punctuation">.</span><span class="token function">restoring</span><span class="token punctuation">(</span>originator<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>originator<span class="token punctuation">)</span>
    <span class="token function">setTodoListCollection</span><span class="token punctuation">(</span>originator<span class="token punctuation">.</span><span class="token function">getTodoList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    todoListCollection<span class="token punctuation">,</span>
    addTodoList<span class="token punctuation">,</span>
    addTodo<span class="token punctuation">,</span>
    allAddTodo<span class="token punctuation">,</span>
    allRemoveTodo<span class="token punctuation">,</span>
    rollback
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> useTodo</code></pre>
<p>custom hook인 useTodo 입니다. 모델과 대응되고 있으며, 모델의 코드를 프론트에 제공해주기 위해 리액트 코드로 변환하는 과정입니다.</p>
<ol>
<li>CareTaker와 originator를 최상단에 선언해줍니다. hooks안에 선언하면 매 갱신시마다 새로 할당이 되므로, 메모리에서 못써먹습니다. 그러므로 useHooks 파일이 불렸을 때 메모리에 로드되도록 선언합니다.</li>
<li>custom hooks의 todoListCollection을 useState로 상태를 만듭니다. 상태의 타입은 모델이므로 TodoList[]로 지정합니다. 해당 부분을 TodoListCollection Class로 하지 않는 이유는, 상태 변경으로 리스트 갱신이 React에서는 클래스 단일로 진행하기 어렵기 때문입니다.</li>
<li>reRender 함수는 shallow copy를 통해 React Component가 재랜더링 할 수 있도록 도와주는 함수입니다.</li>
<li>addTodoList, addTodo등 추가하거나 삭제하는 함수들의 내부에서는 상태 변경 전에 현재 스냅샷을 찍어 originator에 등록하고, careTaker에서 배열에 저장합니다.</li>
</ol>
<p>그리고 상태와 함수를 추출하여 밖으로 내보냅니다.</p>
<br>

<p><strong>src/components/Todo.tsx</strong></p>
<pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token string">'../App.css'</span>

<span class="token keyword">interface</span> <span class="token class-name">IProps</span> <span class="token punctuation">{</span>
  message<span class="token punctuation">:</span> string
<span class="token punctuation">}</span>

<span class="token keyword">const</span> Todo<span class="token punctuation">:</span> React<span class="token punctuation">.</span>FC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IProps</span><span class="token punctuation">></span></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> message <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>todo<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token punctuation">{</span>message<span class="token punctuation">}</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Todo</code></pre>
<p>Todo Component는 간단하게 message만 prop으로 받아서 렌더링을 해줍니다.</p>
<br>

<p><strong>src/components/Todos.tsx</strong></p>
<pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token string">'../App.css'</span>

<span class="token keyword">import</span> TodoList <span class="token keyword">from</span> <span class="token string">'../models/TodoList'</span>
<span class="token keyword">import</span> Todo <span class="token keyword">from</span> <span class="token string">'./Todo'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> convertNumberToKorean <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../utils'</span>

<span class="token keyword">interface</span> <span class="token class-name">IProps</span> <span class="token punctuation">{</span>
  todos<span class="token punctuation">:</span> TodoList
  index<span class="token punctuation">:</span> number
  <span class="token function">addTodo</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">:</span> TodoList<span class="token punctuation">,</span> message<span class="token punctuation">:</span> string<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> Todos<span class="token punctuation">:</span> React<span class="token punctuation">.</span>FC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IProps</span><span class="token punctuation">></span></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> todos<span class="token punctuation">,</span> index<span class="token punctuation">,</span> addTodo <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>todos<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>todos-title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span><span class="token function">convertNumberToKorean</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>todos-wrapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token punctuation">{</span>todos<span class="token punctuation">.</span><span class="token function">getTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>todo<span class="token punctuation">,</span> idx<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Todo</span> <span class="token attr-name">message</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>idx<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button</span> <span class="token attr-name">bottom-absolute"</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token function">addTodo</span><span class="token punctuation">(</span>todos<span class="token punctuation">,</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>todos<span class="token punctuation">.</span><span class="token function">getTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 번째 테스트`</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
      <span class="token attr-name">}</span><span class="token punctuation">></span></span><span class="token operator">+</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Todos</code></pre>
<p>Todos에서는 TodoList 모델을 받아서 렌더링 해줍니다.</p>
<ol>
<li>index를 받는 이유는 실행하고 하나, 둘, 셋 등의 한국말로 텍스트를 띄워주기 위해 index 번호를 받습니다.</li>
<li>addTodo는 추가 된 후 렌더링을 해주어야 하므로 hooks에서 만든 함수를 Prop Drilling 으로 내려줍니다.</li>
<li>convertNumberToKorean은 하나, 둘, 셋 과 같이 한글 숫자로 번역해주도록 만든 함수입니다.</li>
</ol>
<br>

<h2 id="App-적용"><a href="#App-적용" class="headerlink" title="App 적용"></a>App 적용</h2><p>App에서 실제로 적용해줍니다.</p>
<pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token string">'./App.css'</span>

<span class="token keyword">import</span> useTodo <span class="token keyword">from</span> <span class="token string">'./hooks/useTodo'</span>
<span class="token keyword">import</span> Todos <span class="token keyword">from</span> <span class="token string">'./components/Todos'</span>

<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> todoListCollection<span class="token punctuation">,</span> addTodoList<span class="token punctuation">,</span> addTodo<span class="token punctuation">,</span> allAddTodo<span class="token punctuation">,</span> allRemoveTodo<span class="token punctuation">,</span> rollback <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useTodo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token function">addTodoList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>collection<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token punctuation">{</span>todoListCollection<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>todoList<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Todos</span> <span class="token attr-name">todos</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>todoList<span class="token punctuation">}</span></span> <span class="token attr-name">index</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span></span> <span class="token attr-name">addTodo</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>addTodo<span class="token punctuation">}</span></span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>addTodoList<span class="token punctuation">}</span></span><span class="token punctuation">></span></span>콜렉션 추가<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token function">allAddTodo</span><span class="token punctuation">(</span><span class="token string">'전체 추가'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span>전체 추가<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token function">allRemoveTodo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span>전체 삭제<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span>롤백<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App</code></pre>
<h2 id="실행"><a href="#실행" class="headerlink" title="실행"></a>실행</h2><p><img src="https://github.com/Vallista/React-Memento-Pattern-Use-TypeScript/blob/master/screenshots/1.gif?raw=true" alt="2"><br>(사진 4: 결과)</p>
<p>실행을 해보면 롤백이 제대로 동작하는 걸 볼 수 있습니다.</p>
<h2 id="결론"><a href="#결론" class="headerlink" title="결론"></a>결론</h2><p>메멘토 패턴을 사용해 현재 상태를 저장하고, 롤백하는 구현을 쉽게 진행하였습니다. 다만 상태가 많아지면 메모리를 많이 먹으므로 최대 배열의 갯수를 잡아 코딩을 진행하는게 좋습니다.</p>
<p>또한 메멘토 패턴은 커멘드 패턴을 통해 커맨드에 대한 롤백 및 미래에 대한 커맨드를 기억하고 추가하거나 하여 시뮬레이팅 시스템을 구현할 수도 있습니다.</p>

        </div>
        
        <div class="post-tag">
            
            <a class="tag" href="/tags/Tech/" title="Tech">Tech</a>
            
        </div>
        
    </article>
    <div id="disqus_thread"></div>
    <script>

    /**
    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://vallista-1.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
<div class="paginator">
    
        
            <a class="prev" href="/2020/06/14/면접에서-의미있는-질문을-하고-있나요/">
                <div class="wrapper">
                    <i class="iconfont icon-prev"></i>
                    <
                    <span class="nav-default">면접에서 의미있는 질문을 하고 있나요</span>
                    <span class="nav-mobile">이전글</span>
                </div>
            </a>
        
        
            <a class="next" href="/2020/05/22/TypeScript-디자인-패턴-옵저버-패턴/">
                <div class="wrapper">
                    <span class="nav-default">TypeScript 디자인 패턴 - 옵저버 패턴</span>
                    <span class="nav-mobile">다음글</span>
                    >
                    <i class="iconfont icon-next"></i>
                </div>
            </a>
        
    
</div>
<div id="comment-container"></div>
    </div>
</div>
<footer class="footer-social">
    

    

    

    <div class="footer-copyright">
        <p class="time-line">
            &copy;
            
            
            2020
            &nbsp;<i class="iconfont icon-heart"></i>&nbsp;
            <a target="_blank" href="https://github.com/vallista">Vallista</a>
        </p>
        <p class="theme-info">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Theme -
            <a target="_blank" href="https://github.com/">Vallista</a>
        </p>
    </div>
</footer>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
    

</script>
</html>
